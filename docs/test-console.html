<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Console Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Console Test</h1>
        
        <div id="status" class="mb-4 p-4 bg-blue-800 rounded">
            <p>Open browser console (F12) to see detailed logs...</p>
        </div>
        
        <div id="results" class="bg-gray-800 p-4 rounded">
            <p>Results will appear here...</p>
        </div>
    </div>

    <script>
        console.log('üöÄ Console test starting...');
        
        // Test if Chart.js is loading
        if (typeof Chart !== 'undefined') {
            console.log('‚úÖ Chart.js is available');
        } else {
            console.error('‚ùå Chart.js is NOT available');
        }
        
        // Test basic fetch
        async function testBasicFetch() {
            try {
                console.log('Testing basic manifest fetch...');
                const response = await fetch('./daily_snapshots/manifest.json');
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Manifest data:', data);
                    
                    document.getElementById('results').innerHTML = `
                        <h3 class="text-lg font-bold mb-2">Basic Test Results:</h3>
                        <p class="text-green-400">‚úÖ Manifest loaded successfully</p>
                        <p><strong>Flare files:</strong> ${data.flare?.length || 0}</p>
                        <p><strong>Songbird files:</strong> ${data.songbird?.length || 0}</p>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.error('‚ùå Test failed:', error);
                document.getElementById('results').innerHTML = `
                    <h3 class="text-lg font-bold mb-2 text-red-400">Test Failed:</h3>
                    <p class="text-red-400">${error.message}</p>
                `;
            }
        }
        
        // Test if we can actually call the same functions as the main dashboard
        async function testDashboardFunctions() {
            console.log('Testing dashboard-like functionality...');
            
            // Copy the same BASE_URL logic from index.html
            const BASE_URL = location.protocol === 'file:'
                ? 'https://raw.githubusercontent.com/tripkane/flare-ftso-snapshot/main/docs'
                : '.';
            
            console.log('BASE_URL:', BASE_URL);
            
            // Copy the fetchJsonSafe function from index.html
            async function fetchJsonSafe(url, timeoutMs = 8000) {
                try {
                    console.log('üîÑ Fetching:', url);
                    
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => {
                        console.log(`‚è∞ Timeout reached for: ${url}`);
                        controller.abort();
                    }, timeoutMs);
                    
                    const res = await fetch(url, { 
                        signal: controller.signal,
                        cache: 'no-cache',
                        headers: {
                            'Cache-Control': 'no-cache, no-store, must-revalidate',
                            'Pragma': 'no-cache',
                            'Expires': '0'
                        }
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!res.ok) {
                        console.warn('‚ùå Missing file', url, res.status, res.statusText);
                        return null;
                    }
                    const data = await res.json();
                    console.log('‚úÖ Successfully loaded:', url, 'Size:', JSON.stringify(data).length);
                    return data;
                } catch (err) {
                    if (err.name === 'AbortError') {
                        console.error('üö´ Request aborted (timeout):', url);
                    } else {
                        console.error('üí• Error fetching', url, err);
                    }
                    return null;
                }
            }
            
            try {
                // Test the exact same loading sequence as the main dashboard
                console.log('Step 1: Loading provider list...');
                const remoteUrl = 'https://raw.githubusercontent.com/TowoLabs/ftso-signal-providers/next/bifrost-wallet.providerlist.json';
                console.log('üåê Attempting remote provider list:', remoteUrl);
                let listRes = await fetchJsonSafe(remoteUrl, 5000);
                if (!listRes) {
                    console.log('üîÑ Falling back to local bifrost list');
                    listRes = await fetchJsonSafe(`${BASE_URL}/bifrost-wallet.providerlist.json`, 5000);
                }
                console.log('üìã Provider list result:', listRes ? 'Success' : 'Failed');
                
                console.log('Step 2: Loading manifest...');
                const manifestRes = await fetchJsonSafe(`${BASE_URL}/daily_snapshots/manifest.json`, 5000);
                if (!manifestRes) {
                    console.error('üí• CRITICAL: Manifest missing');
                    return;
                }
                console.log('‚úÖ Manifest loaded:', manifestRes.flare?.length, 'Flare files');
                
                console.log('Step 3: Test loading one data file...');
                if (manifestRes.flare && manifestRes.flare.length > 0) {
                    const testFile = manifestRes.flare[manifestRes.flare.length - 1];
                    const testUrl = `${BASE_URL}/daily_snapshots/${testFile}`;
                    const testData = await fetchJsonSafe(testUrl, 3000);
                    if (testData) {
                        console.log('‚úÖ Test data loaded:', testData.providers?.length, 'providers');
                        console.log('‚úÖ Sample provider:', testData.providers?.[0]);
                    }
                }
                
                document.getElementById('results').innerHTML = `
                    <h3 class="text-lg font-bold mb-2">Dashboard Function Test Results:</h3>
                    <p class="text-green-400">‚úÖ All basic functions working</p>
                    <p><strong>Provider list:</strong> ${listRes ? 'Loaded' : 'Failed'}</p>
                    <p><strong>Manifest:</strong> ${manifestRes ? 'Loaded' : 'Failed'}</p>
                    <p><strong>Data files:</strong> ${manifestRes?.flare?.length || 0} available</p>
                    <p class="text-yellow-400 mt-4">Check browser console (F12) for detailed logs</p>
                `;
                
            } catch (error) {
                console.error('üí• Dashboard function test failed:', error);
                document.getElementById('results').innerHTML = `
                    <h3 class="text-lg font-bold mb-2 text-red-400">Dashboard Test Failed:</h3>
                    <p class="text-red-400">${error.message}</p>
                    <p class="text-yellow-400 mt-4">Check browser console (F12) for detailed logs</p>
                `;
            }
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ DOM loaded, starting tests...');
            await testBasicFetch();
            setTimeout(testDashboardFunctions, 1000);
        });
        
    </script>
</body>
</html>
